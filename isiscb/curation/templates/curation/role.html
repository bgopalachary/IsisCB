{% extends "curation/base.html" %}

{% load rules %}

{% block content %}

{% test_rule 'can_update_user_module' user as update_module %}

<div class="h3 text-warning">Role: {{ role.name }}</div>

<p>
  {{ role.description }}
</p>

{% if update_module %}
<p>
  <a href="{% url 'create_rule_dataset' role.pk %}" class="btn btn-sm btn-primary">Limit records by dataset</a>
  <a href="{% url 'create_rule_crud' role.pk %}" class="btn btn-sm btn-primary">Add allowed actions</a>
  <a href="{% url 'create_rule_citation_field' role.pk 'citation' %}" class="btn btn-sm btn-primary">Add citation field access</a>
  <a href="{% url 'create_rule_citation_field' role.pk 'authority'%}" class="btn btn-sm btn-primary">Add authority field access</a>
  <a href="{% url 'create_user_module_rule' role.pk %}" class="btn btn-sm btn-primary">Add access to user module</a>
</p>
{% endif %}

<table class="table table-striped table-responsive table-hover table-curation">
  <thead>
    <tr>
      <th width="20%">Rule Type</th>
      <th>Rule</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
{% if role.dataset_rules %}
{% for rule in role.dataset_rules %}
    <tr>
      <td>Limited Dataset</td>
      <td>User has access to records with dataset '{{ rule.dataset }}'.</td>
      <td>{% if update_module %}<a title="Remove Rule" href="{% url 'remove_rule' role.id rule.id %}"><i class="fa fa-trash-o" aria-hidden="true"></i> Remove Rule</a>{% endif %}</td>
    </tr>
{% endfor %}
{% endif %}

{% if role.crud_rules %}
{% for rule in role.crud_rules %}
    <tr>
      <td>Permitted Action</td>
      <td>User can <span class="label label-warning">{{ rule.crud_action }}</span> records.</td>
      <td>{% if update_module %}<a title="Remove Rule" href="{% url 'remove_rule' role.id rule.id %}"><i class="fa fa-trash-o" aria-hidden="true"></i> Remove Rule</a>{% endif %}</td>
    </tr>
{% endfor %}
{% endif %}

{% if role.field_rules %}
{% for rule in role.field_rules %}
    <tr>
      <td>Field Access <span class="label label-info">{{ rule.get_object_type_display }}</span></td>
      <td>User <span class="label label-warning">{{ rule.get_field_action_display }}</span> field '{{ rule.field_name }}'.</td>
      <td>{% if update_module %}<a title="Remove Rule" href="{% url 'remove_rule' role.id rule.id %}"><i class="fa fa-trash-o" aria-hidden="true"></i> Remove Rule</a>{% endif %}</td>
    </tr>
{% endfor %}
{% endif %}

{% if role.user_module_rules %}
{% for rule in role.user_module_rules %}
    <tr>
      <td>User Module Access</td>
      <td>User can <span class="label label-warning">{{ rule.get_module_action_display }}</span> user module.</td>
      <td>{% if update_module %}<a title="Remove Rule" href="{% url 'remove_rule' role.id rule.id %}"><i class="fa fa-trash-o" aria-hidden="true"></i> Remove Rule</a>{% endif %}</td>
    </tr>
{% endfor %}
{% endif %}

  </tbody>
</table>

{% endblock %}
