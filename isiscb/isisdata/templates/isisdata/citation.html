{% extends "isisdata/__base.html" %}
{% load app_filters %}
{% load staticfiles %}

{% block extra_head %}
<script>
{% if source_instance_id %}
var SUBJECT_INSTANCE_ID = "{{ source_instance_id }}";
{% endif %}

{% if source_content_type %}
var SUBJECT_CONTENT_TYPE = {{ source_content_type }};
{% endif %}
</script>

<script src="{% static "isisdata/js/comments.js" %}"></script>
{% endblock %}


{% block title %}Citation{% endblock %}

{% block content %}
<div class="row" ng-app="commentsApp">
  <div class="col-sm-3 col-md-2 sidebar">
    <div class="menu">
      <a href="javascript:window.history.back()"><span class="glyphicon glyphicon-arrow-left"></span></a>
      &nbsp; &nbsp;
      <a href="{% url 'index' %}"><span class="glyphicon glyphicon-home"></span></a>
      &nbsp; &nbsp;
      <a href="{% url 'haystack_search' %}"><span class="glyphicon glyphicon-search"></span></a>
      <hr>
    </div>


    <h4>Topics:</h4>
    <ul>
      {% for subject in subjects %}
      <li><a href="{% url 'authority' subject.authority.id %}">{{ subject.authority.name }}</a></li>
      {% endfor %}
    </ul>
    {% if not subjects.all %}
    <i>There are no subjects.</i>
    {% endif %}

    <h4>Time Periods:</h4>
    <ul>
      {% for time in time_periods.all %}
      <li><a href="{% url 'authority' time.authority.id %}">{{ time.authority.name }}</a></li>
      {% endfor %}
    </ul>
    {% if not time_periods.all %}
    <i>There are no time periods.</i>
    {% endif %}

    <h4>Persons:</h4>
    <ul>
      {% for person in persons %}
      <li><a href="{% url 'authority' person.authority.id %}">{{ person.authority.name }}</a></li>
      {% endfor %}
    </ul>
    {% if not persons.all %}
    <i>There are no persons.</i>
    {% endif %}

    <h4>Categories:</h4>
    <ul>
      {% for category in categories %}
      <li><a href="{% url 'authority' category.authority.id %}">{{ category.authority.name }}</a></li>
      {% endfor %}
    </ul>
    {% if not categories.all %}
    <i>There are no categories.</i>
    {% endif %}

  </div>
  <div class="col-sm-offset-3 col-md-offset-2 main col-sm-5 col-md-7">
    <div class="alert alert-info headerbox" role="alert">{{ citation.get_type_controlled_display }}</div>

    <h3>{{ citation.title }}</h3>

    <p><strong>Authors & Contributors:</strong> {% for author in authors %} <a href="{% url 'authority' author.authority.id %}">{{ author.authority.name }};</a> {% endfor %}
    <p><strong>Abstract:</strong> {{ citation.abstract }}</p>
    <p><strong>Description:</strong> {{ citation.description }}</p>

    {% for attribute in citation.attributes.all %}
    <p><strong>{{ attribute.type_controlled }}:</strong> {{ attribute.value_freeform }}</p>
    {% endfor %}

    <table class="details">
      <tr>
        <td>Edition Details:</td><td>{{ citation.edition_details }}</td>
      </tr>
      <tr>
        <td>Physical Details:</td><td>{{ citation.physical_details }}</td>
      </tr>
      <tr>
        <td>Language:</td><td>{{ citation.language.name }}</td>
      </tr>
    </table>

    <table class="details">
      <tr>
        <td>Volume:</td><td>{{ citation.part_details.volume }}</td>
      </tr>
      <tr>
        <td>Issue:</td><td>{{ citation.part_details.issue_free_text }}</td>
      </tr>
      <tr>
        <td>Pages:</td><td>{{ citation.part_details.pages_free_text }}</td>
      </tr>
      {% for prop in properties_map %}
      <tr><td>{{ prop.get_type_controlled_display }}:</td><td> {{ prop.authority.name }}</td></tr>
      {% endfor %}
    </table>

    <table class="details">
      <tr>
        <td>Linked Data:</td>
        <td>{% for entry in citation.linkeddata_entries.all %}{{ entry.universal_resource_name }} ({{ entry.type_controlled }})<br/> {% endfor %}</td>
      </tr>
    </table>

    <div></div>
    {% if related_citations_rb %}
    <h4>Reviewed By</h4>
      <ul>
      {% for cc_rel in related_citations_rb %}
        <li>
          {% if cc_rel.object|get_authors %}
            {% for author in cc_rel.object|get_authors %}
             {{ author.authority.name }};
            {% endfor %}
          {% else %}
            Author missing;
          {% endif %}
          <a href="{% url 'citation' cc_rel.object.id %}">{{ cc_rel.object.title|default:"No title specified" }}</a></li>
      {% endfor %}
      </ul>
    {% endif %}

    <!-- Review of -->
    {% if related_citations_ro or related_citations_inv_rb %}
    <h4>Review Of</h4>
      <ul>
      {% for cc_rel in related_citations_ro %}
        <li>
          {% if cc_rel.object|get_authors %}
            {% for author in cc_rel.object|get_authors %}
             {{ author.authority.name }};
            {% endfor %}
          {% else %}
            Author missing;
          {% endif %}
          <a href="{% url 'citation' cc_rel.object.id %}">{{ cc_rel.object.title|default:"No title specified" }}</a></li>
      {% endfor %}

      {% if related_citations_inv_rb %}
      {% for cc_rel in related_citations_inv_rb %}
          <li>
            {% if cc_rel.subject|get_authors %}
              {% for author in cc_rel.subject|get_authors %}
              {{ author.authority.name }};
              {% endfor %}
            {% else %}
              Author missing;
            {% endif %}
            <a href="{% url 'citation' cc_rel.subject.id %}">{{ cc_rel.subject.title|default:"No title specified" }}</a></li>
        {% endfor %}
      {% endif %}

      </ul>
    {% endif %}

<!-- Includes Chapter -->
    {% if related_citations_ic %}
    <h4>Includes Chapter</h4>
      <ul>
      {% for cc_rel in related_citations_ic %}
        <li>
          {% if cc_rel.object|get_authors %}
            {% for author in cc_rel.object|get_authors %}
             {{ author.authority.name }};
            {% endfor %}
          {% else %}
            Author missing;
          {% endif %}
          <a href="{% url 'citation' cc_rel.object.id %}">{{ cc_rel.object.title|default:"No title specified" }}</a></li>
      {% endfor %}
      </ul>
    {% endif %}

    {% if related_citations_inv_ic %}
    <h4>Included in</h4>
      <ul>
      {% for cc_rel in related_citations_inv_ic %}
        <li>
          {% if cc_rel.subject|get_authors %}
            {% for author in cc_rel.subject|get_authors %}
            {{ author.authority.name }};
            {% endfor %}
          {% else %}
            Author missing;
          {% endif %}
          <a href="{% url 'citation' cc_rel.subject.id %}">{{ cc_rel.subject.title|default:"No title specified" }}</a></li>
      {% endfor %}
      </ul>
    {% endif %}

<!-- Includes Series Article -->
    {% if related_citations_isa %}
    <h4>Includes Series Articles</h4>
      <ul>
      {% for cc_rel in related_citations_isa %}
        <li>
          {% if cc_rel.object|get_authors %}
            {% for author in cc_rel.object|get_authors %}
             {{ author.authority.name }};
            {% endfor %}
          {% else %}
            Author missing;
          {% endif %}
          <a href="{% url 'citation' cc_rel.object.id %}">{{ cc_rel.object.title|default:"No title specified" }}</a></li>
      {% endfor %}
      </ul>
    {% endif %}

    {% if related_citations_inv_isa %}
    <h4>Included in</h4>
      <ul>
      {% for cc_rel in related_citations_inv_isa %}
        <li>
          {% if cc_rel.subject|get_authors %}
            {% for author in cc_rel.subject|get_authors %}
            {{ author.authority.name }};
            {% endfor %}
          {% else %}
            Author missing;
          {% endif %}
          <a href="{% url 'citation' cc_rel.subject.id %}">{{ cc_rel.subject.title|default:"No title specified" }}</a></li>
      {% endfor %}
      </ul>
    {% endif %}

<!-- Response to -->
    {% if related_citations_re %}
    <h4>Response to</h4>
      <ul>
      {% for cc_rel in related_citations_re %}
        <li>
          {% if cc_rel.object|get_authors %}
            {% for author in cc_rel.object|get_authors %}
             {{ author.authority.name }};
            {% endfor %}
          {% else %}
            Author missing;
          {% endif %}
          <a href="{% url 'citation' cc_rel.object.id %}">{{ cc_rel.object.title|default:"No title specified" }}</a></li>
      {% endfor %}
      </ul>
    {% endif %}

    {% if related_citations_inv_re %}
    <h4>Has Response</h4>
      <ul>
      {% for cc_rel in related_citations_inv_re %}
        <li>
          {% if cc_rel.subject|get_authors %}
            {% for author in cc_rel.subject|get_authors %}
            {{ author.authority.name }};
            {% endfor %}
          {% else %}
            Author missing;
          {% endif %}
          <a href="{% url 'citation' cc_rel.subject.id %}">{{ cc_rel.subject.title|default:"No title specified" }}</a></li>
      {% endfor %}
      </ul>
    {% endif %}

  <!-- Associated with -->
    {% if related_citations_as %}
    <h4>Associated with</h4>
      <ul>
      {% for cc_rel in related_citations_as %}
        <li>
          {% if cc_rel.object|get_authors %}
            {% for author in cc_rel.object|get_authors %}
             {{ author.authority.name }};
            {% endfor %}
          {% else %}
            Author missing;
          {% endif %}
          <a href="{% url 'citation' cc_rel.object.id %}">{{ cc_rel.object.title|default:"No title specified" }}</a></li>
      {% endfor %}
      </ul>
    {% endif %}




    </div>

    <div class="col-sm-4 col-md-3 main">
        {% include "isisdata/comments.html" %}

    </div>


  </div>


{% endblock %}
